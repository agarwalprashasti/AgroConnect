<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <!-- Title -->
  <title>AgroConnect</title>
  <!-- Favicon -->
  <link rel="icon" href="img/core-img/favicon.ico">
  <!-- Core Stylesheet -->
  <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/weather.css">
</head>

<body>
  <!-- Preloader -->
  <div class="preloader d-flex align-items-center justify-content-center">
    <div class="spinner"></div>
  </div>

  <!-- ##### Header Area Start ##### -->
  <header class="header-area">
    <div class="famie-main-menu">
      <div class="classy-nav-container breakpoint-off">
        <div class="container">
          <!-- Menu -->
          <nav class="classy-navbar justify-content-between" id="famieNav">
            <!-- Nav Brand -->
            <a href="index.html" class="nav-brand"><img src="img/core-img/new-logo.jpeg" alt="" style="margin-top:0px; margin-left:150px; height:70px;width:120px;"></a>
            <!-- Navbar Toggler -->
            <div class="classy-navbar-toggler">
              <span class="navbarToggler"><span></span><span></span><span></span></span>
            </div>
            <!-- Menu -->
            <div class="classy-menu">
              <!-- Close Button -->
              <div class="classycloseIcon">
                <div class="cross-wrap"><span class="top"></span><span class="bottom"></span></div>
              </div>
              <!-- Navbar Start -->
              <div class="classynav">
                <ul>
                  <li ><a href="index.html">Home</a></li>

                  <li><a href="#contact-area">Contact</a></li>
                </ul>
                <!-- Search Icon -->

              </div>
              <!-- Navbar End -->
            </div>
          </nav>

          <!-- Search Form -->
          <div class="search-form">
            <form action="#" method="get">
              <input type="search" name="search" id="search" placeholder="Type keywords &amp; press enter...">
              <button type="submit" class="d-none"></button>
            </form>
            <!-- Close Icon -->
            <div class="closeIcon"><i class="fa fa-times" aria-hidden="true"></i></div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!-- ##### Header Area End ##### -->

  <!-- ##### Breadcrumb Area Start ##### -->
  <div class="breadcrumb-area bg-img bg-overlay jarallax" style="background-image: url('img/bg-img/92.jpeg');">
    <div class="container h-100">
      <div class="row h-100 align-items-center">
        <div class="col-12">
          <div class="breadcrumb-text">
            <h2>Weather Conditions</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="famie-breadcrumb">
    <div class="container">
      <nav aria-label="breadcrumb">

      </nav>
    </div>
  </div>
  <!-- ##### Breadcrumb Area End ##### -->
  <section>
  		<h1 id="location" class="info-text"></h1>
  		<!-- <div class="button"><span class="unit">C</span><span id="exchange"><i class="fa fa-exchange" aria-hidden="true"></i></span><span class="unit">F</span></div> -->
  		<div class="main-container">
  			<div class="top">
  				<div class="canvas-description">
  					<canvas id="skycon" width="100" height="100"></canvas>
  					<p id="description" class="info-text"></p>
  				</div>
  				<!-- <div class="faces">
  					<p class="face"><i style="color:#fe5d5d" class="fa fa-frown-o" aria-hidden="true"></i></p>
  					<p class="face"><i style="color:#feae5d" class="fa fa-meh-o" aria-hidden="true"></i></p>
  					<p class="face"><i style="color:#5dfeae" class="fa fa-smile-o" aria-hidden="true"></i></p>
  					<p class="face"><i style="color:#5daefe" class="fa fa-frown-o" aria-hidden="true"></i></p>
  				</div> -->
  				<div class="scale-container">
  					<div class="scale">
  						<div id="fill"></div>
  					</div>
  					<span class="temp"><i class="fa fa-caret-left" aria-hidden="true"></i><p id="temp"></p></span>
  				</div>
  			</div>

  			<div class="info-row">
  				<canvas id="rain-canvas" width="30" height="30" title="Chance of rain"></canvas><span id="rain" class="small-info-text"></span>
  				<canvas id="wind-canvas" width="30" height="30" title="Wind speed"></canvas><span id="wind" class="small-info-text"></span>
  				<p id="app-temp" class="small-info-text"></p>
  			</div>
  		</div>
  		<div class="forecast">
  			<div class="day-container1 dc">
  				<div class="info">
  					<p class="day">
  					</p>
  					<canvas id="canvas1" width="50" height="50" class="mini-canvas"></canvas>
  					<span class="mini-temp">
  				</span>
  				</div>
  				<div class="mini-scale">
  					<div class="mini-fill">
  					</div>
  				</div>
  			</div>
  			<div class="day-container2 dc">
  				<div class="info">

  					<p class="day">
  					</p>
  					<canvas id="canvas2" width="50" height="50" class="mini-canvas"></canvas>
  					<span class="mini-temp">
  				</span>
  				</div>

  				<div class="mini-scale">
  					<div class="mini-fill">
  					</div>
  				</div>
  			</div>
  			<div class="day-container3 dc">
  				<div class="info">

  					<p class="day">
  					</p>
  					<canvas id="canvas3" width="50" height="50" class="mini-canvas"></canvas>
  					<span class="mini-temp">
  				</span>
  				</div>

  				<div class="mini-scale">
  					<div class="mini-fill">
  					</div>
  				</div>
  			</div>
  			<div class="day-container4 dc">
  				<div class="info">

  					<p class="day">
  					</p>
  					<canvas id="canvas4" width="50" height="50" class="mini-canvas"></canvas>
  					<span class="mini-temp">
  				</span>
  				</div>

  				<div class="mini-scale">
  					<div class="mini-fill">
  					</div>
  				</div>
  			</div>
  			<div class="day-container5 dc">
  				<div class="info">

  					<p class="day">
  					</p>
  					<canvas id="canvas5" width="50" height="50" class="mini-canvas"></canvas>
  					<span class="mini-temp">
  				</span>
  				</div>

  				<div class="mini-scale">
  					<div class="mini-fill">
  					</div>
  				</div>
  			</div>
  		</div>
  	</section>

    	<script src="https://use.fontawesome.com/b5722f1bf7.js"></script>
  <script src="https://rawgithub.com/darkskyapp/skycons/master/skycons.js"></script>
  <footer class="footer-area" id="contact-area">
    <!-- Main Footer Area -->
    <div class="main-footer bg-img bg-overlay section-padding-80-0" style="background-image: url(img/bg-img/3.jpg);">
      <div class="container">
        <div class="row">

          <!-- Single Footer Widget Area -->
          <div class="col-12 col-sm-6 col-lg-3">
            <div class="footer-widget mb-80">
              <a href="#" class="foo-logo d-block mb-30"><img src="img/core-img/new-logo.jpeg" alt=""></a>
              <p style="bold">Investments in agriculture are the best weapons against hunger and poverty, and they have made life better for billions of people.</p>
              <div class="contact-info">
                <p><i class="fa fa-map-pin" aria-hidden="true"></i><span>Rajasthan, India</span></p>
                <p><i class="fa fa-envelope" aria-hidden="true"></i><span>info.agroconnect@gmail.com</span></p>
                <p><i class="fa fa-phone" aria-hidden="true"></i><span>+91-9458218619</span></p>
              </div>
            </div>
          </div>

          <!-- Single Footer Widget Area -->
          <div class="col-12 col-sm-6 col-lg-3">
          <h5 class="widget-title" style="color:white;">WHERE WE ARE</h5>
              <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3573.7096383650714!2d74.65889401435399!3d26.400566888306223!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x396be172836cdae9%3A0x649b156f6ec78963!2sGovernment%20women%20engineering%20College%20Ajmer!5e0!3m2!1sen!2sin!4v1578395051383!5m2!1sen!2sin" width="400" height="300" frameborder="0" style="border:0;" allowfullscreen=""></iframe>

          </div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;


          <div class="col-12 col-sm-6 col-lg-3">
            <div class="footer-widget mb-80">
              <h5 class="widget-title">STAY CONNECTED</h5>
              <!-- Footer Social Info -->
              <div class="footer-social-info">
                <a href="#">
                  <i class="fa fa-facebook" aria-hidden="true"></i>
                  <span>Facebook</span>
                </a>
                <a href="#">
                  <i class="fa fa-twitter" aria-hidden="true"></i>
                  <span>Twitter</span>
                </a>
                <a href="#">
                  <i class="fa fa-pinterest" aria-hidden="true"></i>
                  <span>Pinterest</span>
                </a>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Copywrite Area  -->

    </div>
  </footer>
  <script src="js/jquery.min.js"></script>
  <!-- Popper js -->
  <script src="js/popper.min.js"></script>
  <!-- Bootstrap js -->
  <script src="js/bootstrap.min.js"></script>
  <!-- Owl Carousel js -->
  <script src="js/owl.carousel.min.js"></script>
  <!-- Classynav -->
  <script src="js/classynav.js"></script>
  <!-- Wow js -->
  <script src="js/wow.min.js"></script>
  <!-- Sticky js -->
  <script src="js/jquery.sticky.js"></script>
  <!-- Magnific Popup js -->
  <script src="js/jquery.magnific-popup.min.js"></script>
  <!-- Scrollup js -->
  <script src="js/jquery.scrollup.min.js"></script>
  <!-- Jarallax js -->
  <script src="js/jarallax.min.js"></script>
  <!-- Jarallax Video js -->
  <script src="js/jarallax-video.min.js"></script>
  <!-- Active js -->
  <script src="js/active.js"></script>
  <script>var gV = {
    toggled: true,
}


$(document).ready(function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(success, error);
        console.log("nav available");
    } else {
        console.log("no nav");
        geoFail();
    }
});

function success(data) {
    $("section").show();
    console.log(data.coords.latitude);
    getWeather(data.coords.latitude, data.coords.longitude);
    getLocationInfo(null, data.coords.latitude, data.coords.longitude);
}

function error(err) {
    console.log("error", err);
    //allow user to input data
    geoFail();
}



//funtion to get lat and lon based on navigator geolocationName failure or denial
function geoFail() {
    var input;
    //append a zipcode based search to the page
    $("body").prepend('<div class="location-search"><h1>Find your local weather</h1><span><input type="text" name="input-field" autofocus placeholder="92554 or San Francisco, CA"><button type="button" name="search"><i class="fa fa-search" aria-hidden="true"></i> Search</button></span></div>');
    //if the search icon/button is clicked, or enter key is pressed...
    function proccessInput() {
        //get any zipcode in the users input and use that first
        input = document.getElementsByName("input-field")[0].value;
        var re = new RegExp(/\d{5}/, "gi") //searches for 5 consecutive numbers
        var matched = input.match(re) //returns an array of each instance of 5 consecutive numbers
        if (matched != null) {
            //the input is a zipcode
            getLocationInfo(matched[0]);
            console.log(matched[0]);
        } else {
            //get the city and state values
            var new_arr = input.split(",");
            console.log(new_arr);
            getLocationInfo(null, null, null, new_arr);
        }
    }

    $("button").click(function() {
        proccessInput();
    });
    $(window).keypress(function(event) {
        var code = event.which;
        if (code === 13) {
            proccessInput();
        }
    });
}


function getLocationInfo(zip, lat, lon, name) {
    var locationName;
    if (zip) {
        console.log("user searched by zip");
        //call to google geocoding using zip only
        $.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address=" + zip + "&key=AIzaSyCuugDMliUtuYZ1tT2PZbgB_LMvOYi0wFU", (loc) => {
            locationName = loc.results[0].formatted_address;
            processCityName(locationName);
            //get the weather
            getWeather(loc.results[0].geometry.location.lat, loc.results[0].geometry.location.lng);
        })
    } else if (zip === null && lat && lon) {
        console.log("user used nav");
        //get the city name based on geographic coords
        $.getJSON("https://maps.googleapis.com/maps/api/geocode/json?latlng=" + lat + "," + lon + "&key=AIzaSyCuugDMliUtuYZ1tT2PZbgB_LMvOYi0wFU", (info) => {
            for (var i = 0; i < info.results.length; i++) {
                for (var j = 0; j < info.results[i].types.length; j++) {
                    if (info.results[i].types[j] == "locality") {
                        locationName = info.results[i].formatted_address;
                        processCityName(locationName);
                    }
                }
            }
        });
    }
    //call to google geocoding using city and state
    else if (zip === null && lat === null && lon ===null && name) {
        console.log("user searched by name");
        $.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address=" + name[0] + "+" + name[1] + "&key=AIzaSyCuugDMliUtuYZ1tT2PZbgB_LMvOYi0wFU", (loc) => {
            locationName = loc.results[0].formatted_address;
            processCityName(locationName);
            getWeather(loc.results[0].geometry.location.lat, loc.results[0].geometry.location.lng);
        });
    }

    //search through the reverse geolocationName info to find the right info
    function processCityName(location) {
        //cut out the "USA" part
        location = location.split(",");
          for(var f =0; f < location.length -2; f++) {
            location.pop();
            }
        location = location.join(", ");
        //insert the formatted location
        var locP = document.getElementById('location');
        locP.innerText = location;
    }
}


function getWeather(lat, lon) {
    //this request has to be done as jsonp because of cross-domain policies on the browser
    //adding ?callback=? makes the server treat the request as jsonp, the other option would be
    //to use .ajax(dataType: "jsonp")
    $.getJSON("https://api.forecast.io/forecast/b59cb056ae86ddcff4531258c647bf0d/" + lat + "," + lon + "?callback=?",
        function(wData) {
            console.log(wData);
            $(".location-search").hide();

            //get main current icon (working!)
            var current_icon = wData.currently.icon.toUpperCase();

            //create icon objects for current weather
            var skycon = new Skycons({
                "color": "black"
            });
            var windIcon = new Skycons({
              "color": "black"
            });
            var rainIcon = new Skycons({
              "color": "black"
            });

            //add the skyccon icon types
            skycon.add("skycon", current_icon);
            rainIcon.add("rain-canvas", "rain");
            windIcon.add("wind-canvas", "wind");

            //play the icons
            skycon.play();
            windIcon.play();
            rainIcon.play();


            var rainProb = wData.currently.precipProbability * 100;
            var windSpeed = Math.round(wData.currently.windSpeed);
            var app_temp = Math.round(wData.currently.apparentTemperature);

            tempScale(wData.currently.temperature);
            tempToggle(wData.currently.temperature, app_temp, wData.daily.data);

            $("#description").html(wData.currently.summary);
            $("#rain").html(rainProb + "%");
            $("#wind").html(windSpeed + " Mph");
            $("#app-temp").html("Feels like: " + app_temp + "&deg;");
            populateForecast(wData.daily.data);

            $("section").show();

            setTempPosition();
        });
}

function populateForecast(forecast_arr) {
    var date;
    var day_arr = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    var forecast_days;
    var height;
    var temp;
    var color;

    //populating names of days
    date = new Date;
    date = date.getDay();

    //populate icons and temperature
    for (var i = 1; i <= 5; i++) {
        forecast_days = date + i;
        if (forecast_days > 6) {
            forecast_days -= 7;
        }
        $(".day-container" + i + " p").html(day_arr[forecast_days]);
        //end days
        var mini_icon = new Skycons({
            "color": "black"
        })
        mini_icon.add("canvas" + i, forecast_arr[i].icon);
        mini_icon.play();
        //temperature
        $(".day-container" + i + " span").html(Math.round(forecast_arr[i].temperatureMax) + "&deg;F");
        //make the color and fill heights for mini scale
        temp = Math.round(forecast_arr[i].temperatureMax);
        if (temp >= 0 && temp < 60) {
            color = "#5daefe";
        } else if (temp >= 60 && temp < 80) {
            color = "#5dfeae";
        } else if (temp >= 80 && temp < 90) {
            color = "#feae5d";
        } else {
            color = "#fe5d5d";
        }
        height = forecast_arr[i].temperatureMax;
        $(".day-container" + i + " .mini-fill").css({
            "height": height,
            "background-color": color
        });
    }
}


//working
function tempToggle(tempInF, app_temp, forecast_arr) {
    tempInF = Math.round(tempInF);
    var tempInC = Math.round((tempInF - 32) * (5 / 9));
    var app_tempInC = Math.round((app_temp - 32) * (5 / 9));
    var tempElement = document.getElementById('temp');
    tempElement.innerText = tempInF;
    tempElement.innerHTML += "&deg;F";
    //attach click handler to toggle to/from F/C
    $("#temp").click(function() {
        if (gV.toggled === true) {
          $("#app-temp").html("Feels like: " + app_tempInC + "&deg;");

            tempElement.innerText = tempInC;
            tempElement.innerHTML += "&deg;C";
            for (var i = 1; i <= 5; i++) {
                tempC = Math.round((forecast_arr[i].temperatureMax - 32) * (5 / 9));
                $(".day-container" + i + " span").html(tempC + "&deg;C");
            }
            gV.toggled = false;
        } //end if statement
        else if (gV.toggled === false) {
          $("#app-temp").html("Feels like: " + app_temp + "&deg;");

            tempElement.innerText = tempInF;
            tempElement.innerHTML += "&deg;F";
            for (var j = 1; j <= 5; j++) {
                $(".day-container" + j + " span").html(Math.round(forecast_arr[j].temperatureMax) + "&deg;F");
            }
            gV.toggled = true;
        }
    });
}


//working
function tempScale(temp) {
    //convert temperature into a usable height
    var fill_height = Math.round(temp * 1.7);
    var color;
    temp = Math.round(temp);

    var applyCSS = () => {
        $("#fill").css({
            "background-color": color,
            "height": fill_height
        });
      }

    if (temp >= 0 && temp < 60) {
        color = "#5daefe";
        applyCSS();
    } else if (temp >= 60 && temp < 80) {
        color = "#5dfeae";
        applyCSS();
    } else if (temp >= 80 && temp < 90) {
        color = "#feae5d";
        applyCSS();
    } else {
        color = "#fe5d5d";
        applyCSS();
    }
}

function setTempPosition() {
  var arrowLoc = $("#fill").offset();
  var p_height = $("#temp").height();
  var scale_width = $(".scale").width();
  console.log(arrowLoc);
  $(".temp").offset({top: arrowLoc.top - p_height / 2, left: arrowLoc.left + scale_width});
   $("#temp").offset({top: arrowLoc.top - p_height / 2, left: arrowLoc.left + scale_width + 20})
}
</script>
</body>

</html>
